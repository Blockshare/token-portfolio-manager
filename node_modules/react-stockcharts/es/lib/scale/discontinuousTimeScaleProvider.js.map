{"version":3,"sources":["../../../../src/lib/scale/discontinuousTimeScaleProvider.js"],"names":["timeFormat","financeDiscontinuousScale","slidingWindow","zipper","identity","isNotDefined","yearFormat","quarterFormat","monthFormat","weekFormat","dayFormat","hourFormat","minuteFormat","secondFormat","levelDefinition","d","date","i","startOfYear","getFullYear","startOfQuarter","startOfMonth","startOfWeek","startOfDay","startOfHalfDay","startOfQuarterDay","startOfEighthOfADay","startOfHour","getHours","startOf30Minutes","startOf15Minutes","startOf5Minutes","startOfMinute","startOf30Seconds","evaluateLevel","map","l","idx","level","length","format","find","discontinuousIndexCalculator","windowSize","undefinedValue","di","row","getTime","index","discontinuousIndexCalculatorLocalTime","accumulator","prevDate","nowDate","getSeconds","getMinutes","getDay","getMonth","getYear","doStuff","realDateAccessor","inputDateAccessor","initialIndex","data","dateAccessor","calculate","source","misc","discontinuousTimeScaleProviderBuilder","indexAccessor","indexMutator","withIndex","withInterval","discontinuousTimeScaleProvider","interval","response","inputIndex","each","Date","xScale","mergedData","combine","finalData","xAccessor","displayXAccessor","x","arguments","utc","offsetInMillis","getTimezoneOffset","indexCalculator"],"mappings":"AAAA;;;;;;AAEA,SAASA,UAAT,QAA2B,gBAA3B;AACA;;AAEA,OAAOC,yBAAP,MAAsC,6BAAtC;AACA,SAASC,aAAT,EAAwBC,MAAxB,EAAgCC,QAAhC,EAA0CC,YAA1C,QAA8D,UAA9D;;AAEA,IAAMC,aAAa,IAAnB;AACA,IAAMC,gBAAgB,OAAtB;AACA,IAAMC,cAAc,IAApB;AACA,IAAMC,aAAa,OAAnB;AACA,IAAMC,YAAY,OAAlB;AACA,IAAMC,aAAa,QAAnB;AACA,IAAMC,eAAe,UAArB;AACA,IAAMC,eAAe,aAArB;AACA;;AAEA,IAAMC,kBAAkB;;AAEvB;AACA,QAAQ,UAACC,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEG,WAAF,IAAiBF,KAAKG,WAAL,KAAqB,CAArB,KAA2B,CAA5C,IAAiDb,UAAjE;AAAA,CAHe;AAIvB,QAAQ,UAACS,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEG,WAAF,IAAiBZ,UAAjC;AAAA,CAJe;AAKvB,QAAQ,UAACS,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEK,cAAF,IAAoBb,aAApC;AAAA,CALe;AAMvB,QAAQ,UAACQ,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEM,YAAF,IAAkBb,WAAlC;AAAA,CANe;AAOvB,QAAQ,UAACO,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEO,WAAF,IAAiBb,UAAjC;AAAA,CAPe;AAQvB,QAAQ,UAACM,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEQ,UAAF,IAAgBN,IAAI,CAAJ,KAAU,CAA1B,IAA+BP,SAA/C;AAAA,CARe;AASvB,QAAQ,UAACK,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEQ,UAAF,IAAgBb,SAAhC;AAAA,CATe;AAUvB,QAAQ,UAACK,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAES,cAAF,IAAoBb,UAApC;AAAA,CAVe,EAUiC;AACxD,QAAQ,UAACI,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEU,iBAAF,IAAuBd,UAAvC;AAAA,CAXe,EAWoC;AAC3D,QAAQ,UAACI,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEW,mBAAF,IAAyBf,UAAzC;AAAA,CAZe,EAYsC;AAC7D,QAAQ,UAACI,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEY,WAAF,IAAiBX,KAAKY,QAAL,KAAkB,CAAlB,KAAwB,CAAzC,IAA8CjB,UAA9D;AAAA,CAbe,EAa2D;AAClF,QAAQ,UAACI,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEY,WAAF,IAAiBhB,UAAjC;AAAA,CAde,EAc8B;AACrD,QAAQ,UAACI,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEc,gBAAF,IAAsBjB,YAAtC;AAAA,CAfe;AAgBvB,QAAQ,UAACG,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEe,gBAAF,IAAsBlB,YAAtC;AAAA,CAhBe;AAiBvB,QAAQ,UAACG,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEgB,eAAF,IAAqBnB,YAArC;AAAA,CAjBe;AAkBvB,QAAQ,UAACG,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEiB,aAAF,IAAmBpB,YAAnC;AAAA,CAlBe;AAmBvB,QAAQ,UAACG,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBF,EAAEkB,gBAAF,IAAsBpB,YAAtC;AAAA,CAnBe;AAoBvB,QAAQ,UAACE,CAAD,EAAIC,IAAJ,EAAUC,CAAV;AAAA,QAAgBJ,YAAhB;AAAA,CApBe,CAAxB;;AAwBA,SAASqB,aAAT,CAAuBnB,CAAvB,EAA0BC,IAA1B,EAAgCC,CAAhC,EAAmC;AAClC,QAAOH,gBACLqB,GADK,CACD,UAACC,CAAD,EAAIC,GAAJ;AAAA,SAAa,EAAEC,OAAOxB,gBAAgByB,MAAhB,GAAyBF,GAAzB,GAA+B,CAAxC,EAA2CG,QAAQJ,EAAErB,CAAF,EAAKC,IAAL,EAAWC,CAAX,CAAnD,EAAb;AAAA,EADC,EAELwB,IAFK,CAEA;AAAA,SAAK,CAAC,CAACL,EAAEI,MAAT;AAAA,EAFA,CAAP;AAGA;;AAED,IAAME,+BAA+BxC,gBACnCyC,UADmC,CACxB,CADwB,EAEnCC,cAFmC,CAEpB,UAAC7B,CAAD,EAAIsB,GAAJ,EAASQ,EAAT,EAAgB;AAC/B,KAAM5B,IAAI4B,EAAV;AACA,KAAMC,MAAM;AACX9B,QAAMD,EAAEgC,OAAF,EADK;AAEXd,oBAAkB,KAFP;AAGXD,iBAAe,KAHJ;AAIXD,mBAAiB,KAJN;AAKXD,oBAAkB,KALP;AAMXD,oBAAkB,KANP;AAOXF,eAAa,KAPF;AAQXD,uBAAqB,KARV;AASXD,qBAAmB,KATR;AAUXD,kBAAgB,KAVL;AAWXD,cAAY,IAXD;AAYXD,eAAa,KAZF;AAaXD,gBAAc,KAbH;AAcXD,kBAAgB,KAdL;AAeXF,eAAa;AAfF,EAAZ;AAiBA,KAAMoB,QAAQJ,cAAcY,GAAd,EAAmB/B,CAAnB,EAAsBE,CAAtB,CAAd;AACA,qBAAY6B,GAAZ,IAAiBE,OAAO/B,CAAxB,IAA8BqB,KAA9B;AACA,CAvBmC,CAArC;;AAyBA,IAAMW,wCAAwCP,6BAC5CQ,WAD4C,CAChC,gBAAsBjC,CAAtB,EAAyBoB,GAAzB,EAA8BQ,EAA9B,EAAqC;AAAA;AAAA,KAAnCM,QAAmC;AAAA,KAAzBC,OAAyB;;AACjD,KAAMnB,mBAAmBmB,QAAQC,UAAR,KAAuB,EAAvB,KAA8B,CAAvD;;AAEA,KAAMrB,gBAAgBoB,QAAQE,UAAR,OAAyBH,SAASG,UAAT,EAA/C;AACA,KAAMvB,kBAAkBC,iBAAiBoB,QAAQE,UAAR,KAAuB,CAAvB,IAA4BH,SAASG,UAAT,KAAwB,CAA7F;AACA,KAAMxB,mBAAmBE,iBAAiBoB,QAAQE,UAAR,KAAuB,EAAvB,IAA6BH,SAASG,UAAT,KAAwB,EAA/F;AACA,KAAMzB,mBAAmBG,iBAAiBoB,QAAQE,UAAR,KAAuB,EAAvB,IAA6BH,SAASG,UAAT,KAAwB,EAA/F;;AAEA,KAAM3B,cAAcyB,QAAQxB,QAAR,OAAuBuB,SAASvB,QAAT,EAA3C;;AAEA,KAAMF,sBAAsBC,eAAeyB,QAAQxB,QAAR,KAAqB,CAArB,KAA2B,CAAtE;AACA,KAAMH,oBAAoBE,eAAeyB,QAAQxB,QAAR,KAAqB,CAArB,KAA2B,CAApE;AACA,KAAMJ,iBAAiBG,eAAeyB,QAAQxB,QAAR,KAAqB,EAArB,KAA4B,CAAlE;;AAEA,KAAML,aAAa6B,QAAQG,MAAR,OAAqBJ,SAASI,MAAT,EAAxC;AACA;AACA;AACA;AACA,KAAMjC,cAAc8B,QAAQG,MAAR,KAAmBJ,SAASI,MAAT,EAAvC;AACA;AACA,KAAMlC,eAAe+B,QAAQI,QAAR,OAAuBL,SAASK,QAAT,EAA5C;AACA;AACA,KAAMpC,iBAAiBC,gBAAiB+B,QAAQI,QAAR,KAAqB,CAArB,IAA0BL,SAASK,QAAT,KAAsB,CAAxF;AACA;AACA,KAAMtC,cAAckC,QAAQK,OAAR,OAAsBN,SAASM,OAAT,EAA1C;;AAEA,KAAMX,MAAM;AACX9B,QAAMoC,QAAQL,OAAR,EADK;AAEXd,oCAFW;AAGXD,8BAHW;AAIXD,kCAJW;AAKXD,oCALW;AAMXD,oCANW;AAOXF,0BAPW;AAQXD,0CARW;AASXD,sCATW;AAUXD,gCAVW;AAWXD,wBAXW;AAYXD,0BAZW;AAaXD,4BAbW;AAcXD,gCAdW;AAeXF;AAfW,EAAZ;AAiBA,KAAMoB,QAAQJ,cAAcY,GAAd,EAAmBM,OAAnB,EAA4BnC,CAA5B,CAAd;AACA,qBAAY6B,GAAZ,IAAiBE,OAAO/B,IAAI4B,EAA5B,IAAmCP,KAAnC;AACA,CA9C4C,CAA9C;;AAgDA,SAASoB,OAAT,CAAiBC,gBAAjB,EAAmCC,iBAAnC,EAAsDC,YAAtD,EAAoE;AACnE,QAAO,UAASC,IAAT,EAAe;AACrB,MAAMC,eAAeJ,iBAAiBC,iBAAjB,CAArB;AACA,MAAMI,YAAYf,sCAAsCgB,MAAtC,CAA6CF,YAA7C,EAA2DG,IAA3D,CAAgEL,YAAhE,CAAlB;AACA,MAAMb,QAAQgB,UAAUF,IAAV,CAAd;AACA;;;;;;;;;;;;;;;;;;;AAwBA;AACA,SAAO,EAAEd,YAAF,EAAP;AACA,EA9BD;AA+BA;;AAED,OAAO,SAASmB,qCAAT,GAAiD;AACvD,KAAIN,eAAe,CAAnB;AAAA,KAAsBF,mBAAmBvD,QAAzC;AACA,KAAIwD,oBAAoB;AAAA,SAAK7C,EAAEC,IAAP;AAAA,EAAxB;AAAA,KACCoD,gBAAgB;AAAA,SAAKrD,EAAEsB,GAAP;AAAA,EADjB;AAAA,KAECgC,eAAe,sBAACtD,CAAD,EAAIsB,GAAJ;AAAA,sBAAkBtB,CAAlB,IAAqBsB,QAArB;AAAA,EAFhB;AAAA,KAGCiC,kBAHD;AAAA,KAGYC,qBAHZ;;AAKA;AACA,KAAIC,iCAAiC,SAAjCA,8BAAiC,CAASV,IAAT,EAAe;AACnD;;;;;;;;;AASA,MAAId,QAAQsB,SAAZ;AACA,MAAIG,WAAWF,YAAf;AACA,MAAIlE,aAAa2C,KAAb,CAAJ,EAAyB;AACxB,OAAM0B,WAAWhB,QAAQC,gBAAR,EAA0BC,iBAA1B,EAA6CC,YAA7C,EAA2DC,IAA3D,CAAjB;AACAd,WAAQ0B,SAAS1B,KAAjB;AACAyB,cAAWC,SAASD,QAApB;AACA;AACD;;AAEA,MAAME,aAAa3B,MAAMb,GAAN,CAAU,gBAAQ;AAAA,OAC5BK,MAD4B,GACjBoC,IADiB,CAC5BpC,MAD4B;;AAEpC,uBACIoC,IADJ;AAEC5D,UAAM,IAAI6D,IAAJ,CAASD,KAAK5D,IAAd,CAFP;AAGCwB,YAAQxC,WAAWwC,MAAX;AAHT;AAKA,GAPkB,CAAnB;;AASA,MAAMsC,SAAS7E,0BAA0B0E,UAA1B,EAAsCF,QAAtC,CAAf;;AAEA,MAAMM,aAAa5E,SACjB6E,OADiB,CACTX,YADS,CAAnB;;AAGA,MAAMY,YAAYF,WAAWjB,IAAX,EAAiBa,UAAjB,CAAlB;;AAEA,SAAO;AACNb,SAAMmB,SADA;AAENH,iBAFM;AAGNI,cAAW;AAAA,WAAKnE,KAAKqD,cAAcrD,CAAd,EAAiBiC,KAA3B;AAAA,IAHL;AAINmC,qBAAkBxB,iBAAiBC,iBAAjB;AAJZ,GAAP;AAMA,EAzCD;;AA2CAY,gCAA+BX,YAA/B,GAA8C,UAASuB,CAAT,EAAY;AACzD,MAAI,CAACC,UAAU9C,MAAf,EAAuB;AACtB,UAAOsB,YAAP;AACA;AACDA,iBAAeuB,CAAf;AACA,SAAOZ,8BAAP;AACA,EAND;AAOAA,gCAA+BZ,iBAA/B,GAAmD,UAASwB,CAAT,EAAY;AAC9D,MAAI,CAACC,UAAU9C,MAAf,EAAuB;AACtB,UAAOqB,iBAAP;AACA;AACDA,sBAAoBwB,CAApB;AACA,SAAOZ,8BAAP;AACA,EAND;AAOAA,gCAA+BJ,aAA/B,GAA+C,UAASgB,CAAT,EAAY;AAC1D,MAAI,CAACC,UAAU9C,MAAf,EAAuB;AACtB,UAAO6B,aAAP;AACA;AACDA,kBAAgBgB,CAAhB;AACA,SAAOZ,8BAAP;AACA,EAND;AAOAA,gCAA+BH,YAA/B,GAA8C,UAASe,CAAT,EAAY;AACzD,MAAI,CAACC,UAAU9C,MAAf,EAAuB;AACtB,UAAO8B,YAAP;AACA;AACDA,iBAAee,CAAf;AACA,SAAOZ,8BAAP;AACA,EAND;AAOAA,gCAA+BF,SAA/B,GAA2C,UAASc,CAAT,EAAY;AACtD,MAAI,CAACC,UAAU9C,MAAf,EAAuB;AACtB,UAAO+B,SAAP;AACA;AACDA,cAAYc,CAAZ;AACA,SAAOZ,8BAAP;AACA,EAND;AAOAA,gCAA+BD,YAA/B,GAA8C,UAASa,CAAT,EAAY;AACzD,MAAI,CAACC,UAAU9C,MAAf,EAAuB;AACtB,UAAOgC,YAAP;AACA;AACDA,iBAAea,CAAf;AACA,SAAOZ,8BAAP;AACA,EAND;AAOAA,gCAA+Bc,GAA/B,GAAqC,YAAW;AAC/C3B,qBAAmB;AAAA,UAAgB,aAAK;AACvC,QAAM3C,OAAO+C,aAAahD,CAAb,CAAb;AACA;AACA,QAAMwE,iBAAiBvE,KAAKwE,iBAAL,KAA2B,EAA3B,GAAgC,IAAvD;AACA,WAAO,IAAIX,IAAJ,CAAS7D,KAAK+B,OAAL,KAAiBwC,cAA1B,CAAP;AACA,IALkB;AAAA,GAAnB;AAMA,SAAOf,8BAAP;AACA,EARD;AASAA,gCAA+BiB,eAA/B,GAAiD,YAAW;AAC3D,SAAO/B,QAAQC,gBAAR,EAA0BC,iBAA1B,EAA6CC,YAA7C,CAAP;AACA,EAFD;;AAIA,QAAOW,8BAAP;AACA;;AAID;;;;;;;;;;;;;AAaA,eAAeL,uCAAf","file":"discontinuousTimeScaleProvider.js","sourcesContent":["\"use strict\";\n\nimport { timeFormat } from \"d3-time-format\";\n// import { map as d3Map } from \"d3-collection\";\n\nimport financeDiscontinuousScale from \"./financeDiscontinuousScale\";\nimport { slidingWindow, zipper, identity, isNotDefined } from \"../utils\";\n\nconst yearFormat = \"%Y\";\nconst quarterFormat = \"%b %Y\";\nconst monthFormat = \"%b\";\nconst weekFormat = \"%d %b\";\nconst dayFormat = \"%a %d\";\nconst hourFormat = \"%_I %p\";\nconst minuteFormat = \"%I:%M %p\";\nconst secondFormat = \"%I:%M:%S %p\";\n// const milliSecondFormat = \"%L\";\n\nconst levelDefinition = [\n\n\t/* eslint-disable no-unused-vars */\n\t/* 17 */(d, date, i) => d.startOfYear && date.getFullYear() % 2 === 0 && yearFormat,\n\t/* 16 */(d, date, i) => d.startOfYear && yearFormat,\n\t/* 15 */(d, date, i) => d.startOfQuarter && quarterFormat,\n\t/* 14 */(d, date, i) => d.startOfMonth && monthFormat,\n\t/* 13 */(d, date, i) => d.startOfWeek && weekFormat,\n\t/* 12 */(d, date, i) => d.startOfDay && i % 2 === 0 && dayFormat,\n\t/* 11 */(d, date, i) => d.startOfDay && dayFormat,\n\t/* 10 */(d, date, i) => d.startOfHalfDay && hourFormat, // 12h\n\t/*  9 */(d, date, i) => d.startOfQuarterDay && hourFormat, // 6h\n\t/*  8 */(d, date, i) => d.startOfEighthOfADay && hourFormat, // 3h\n\t/*  7 */(d, date, i) => d.startOfHour && date.getHours() % 2 === 0 && hourFormat, // 2h -- REMOVE THIS\n\t/*  6 */(d, date, i) => d.startOfHour && hourFormat, // 1h\n\t/*  5 */(d, date, i) => d.startOf30Minutes && minuteFormat,\n\t/*  4 */(d, date, i) => d.startOf15Minutes && minuteFormat,\n\t/*  3 */(d, date, i) => d.startOf5Minutes && minuteFormat,\n\t/*  2 */(d, date, i) => d.startOfMinute && minuteFormat,\n\t/*  1 */(d, date, i) => d.startOf30Seconds && secondFormat,\n\t/*  0 */(d, date, i) => secondFormat,\n\t/* eslint-enable no-unused-vars */\n];\n\nfunction evaluateLevel(d, date, i) {\n\treturn levelDefinition\n\t\t.map((l, idx) => ({ level: levelDefinition.length - idx - 1, format: l(d, date, i) }))\n\t\t.find(l => !!l.format);\n}\n\nconst discontinuousIndexCalculator = slidingWindow()\n\t.windowSize(2)\n\t.undefinedValue((d, idx, di) => {\n\t\tconst i = di;\n\t\tconst row = {\n\t\t\tdate: d.getTime(),\n\t\t\tstartOf30Seconds: false,\n\t\t\tstartOfMinute: false,\n\t\t\tstartOf5Minutes: false,\n\t\t\tstartOf15Minutes: false,\n\t\t\tstartOf30Minutes: false,\n\t\t\tstartOfHour: false,\n\t\t\tstartOfEighthOfADay: false,\n\t\t\tstartOfQuarterDay: false,\n\t\t\tstartOfHalfDay: false,\n\t\t\tstartOfDay: true,\n\t\t\tstartOfWeek: false,\n\t\t\tstartOfMonth: false,\n\t\t\tstartOfQuarter: false,\n\t\t\tstartOfYear: false,\n\t\t};\n\t\tconst level = evaluateLevel(row, d, i);\n\t\treturn { ...row, index: i, ...level };\n\t});\n\nconst discontinuousIndexCalculatorLocalTime = discontinuousIndexCalculator\n\t.accumulator(([prevDate, nowDate], i, idx, di) => {\n\t\tconst startOf30Seconds = nowDate.getSeconds() % 30 === 0;\n\n\t\tconst startOfMinute = nowDate.getMinutes() !== prevDate.getMinutes();\n\t\tconst startOf5Minutes = startOfMinute && nowDate.getMinutes() % 5 <= prevDate.getMinutes() % 5;\n\t\tconst startOf15Minutes = startOfMinute && nowDate.getMinutes() % 15 <= prevDate.getMinutes() % 15;\n\t\tconst startOf30Minutes = startOfMinute && nowDate.getMinutes() % 30 <= prevDate.getMinutes() % 30;\n\n\t\tconst startOfHour = nowDate.getHours() !== prevDate.getHours();\n\n\t\tconst startOfEighthOfADay = startOfHour && nowDate.getHours() % 3 === 0;\n\t\tconst startOfQuarterDay = startOfHour && nowDate.getHours() % 6 === 0;\n\t\tconst startOfHalfDay = startOfHour && nowDate.getHours() % 12 === 0;\n\n\t\tconst startOfDay = nowDate.getDay() !== prevDate.getDay();\n\t\t// According to ISO calendar\n\t\t// Sunday = 0, Monday = 1, ... Saturday = 6\n\t\t// day of week of today < day of week of yesterday then today is start of week\n\t\tconst startOfWeek = nowDate.getDay() < prevDate.getDay();\n\t\t// month of today != month of yesterday then today is start of month\n\t\tconst startOfMonth = nowDate.getMonth() !== prevDate.getMonth();\n\t\t// if start of month and month % 3 === 0 then it is start of quarter\n\t\tconst startOfQuarter = startOfMonth && (nowDate.getMonth() % 3 <= prevDate.getMonth() % 3);\n\t\t// year of today != year of yesterday then today is start of year\n\t\tconst startOfYear = nowDate.getYear() !== prevDate.getYear();\n\n\t\tconst row = {\n\t\t\tdate: nowDate.getTime(),\n\t\t\tstartOf30Seconds,\n\t\t\tstartOfMinute,\n\t\t\tstartOf5Minutes,\n\t\t\tstartOf15Minutes,\n\t\t\tstartOf30Minutes,\n\t\t\tstartOfHour,\n\t\t\tstartOfEighthOfADay,\n\t\t\tstartOfQuarterDay,\n\t\t\tstartOfHalfDay,\n\t\t\tstartOfDay,\n\t\t\tstartOfWeek,\n\t\t\tstartOfMonth,\n\t\t\tstartOfQuarter,\n\t\t\tstartOfYear,\n\t\t};\n\t\tconst level = evaluateLevel(row, nowDate, i);\n\t\treturn { ...row, index: i + di, ...level };\n\t});\n\nfunction doStuff(realDateAccessor, inputDateAccessor, initialIndex) {\n\treturn function(data) {\n\t\tconst dateAccessor = realDateAccessor(inputDateAccessor);\n\t\tconst calculate = discontinuousIndexCalculatorLocalTime.source(dateAccessor).misc(initialIndex);\n\t\tconst index = calculate(data);\n\t\t/*\n\t\tvar map = d3Map();\n\t\tfor (var i = 0; i < data.length - 1; i++) {\n\n\t\t\tvar nextDate = dateAccessor(data[i + 1]);\n\t\t\tvar nowDate = dateAccessor(data[i]);\n\t\t\tvar diff = nextDate - nowDate;\n\n\t\t\tif (map.has(diff)) {\n\t\t\t\tvar count = parseInt(map.get(diff), 10) + 1;\n\t\t\t\tmap.set(diff, count);\n\t\t\t} else {\n\t\t\t\tmap.set(diff, 1);\n\t\t\t}\n\t\t}\n\n\t\tvar entries = map.entries().sort((a, b) => a.value < b.value);\n\n\t\t// For Renko/p&f\n\n\t\tvar interval = entries[0].value === 1\n\t\t\t? Math.round((dateAccessor(last(data)) - dateAccessor(head(data))) / data.length)\n\t\t\t: parseInt(entries[0].key, 10); */\n\n\t\t// return { index, interval };\n\t\treturn { index };\n\t};\n}\n\nexport function discontinuousTimeScaleProviderBuilder() {\n\tlet initialIndex = 0, realDateAccessor = identity;\n\tlet inputDateAccessor = d => d.date,\n\t\tindexAccessor = d => d.idx,\n\t\tindexMutator = (d, idx) => ({ ...d, idx }),\n\t\twithIndex, withInterval;\n\n\t// eslint-disable-next-line prefer-const\n\tlet discontinuousTimeScaleProvider = function(data) {\n\t\t/*\n\t\tconsole.warn(\"Are you sure you want to use a discontinuousTimeScale?\"\n\t\t\t+ \" Use this only if you have discontinuous data which\"\n\t\t\t+ \" needs to be displayed as continuous.\"\n\t\t\t+ \" If you have continuous data use a d3 scale like\"\n\t\t\t+ \" `d3.scaleTime`\"\n\t\t);\n\t\t*/\n\n\t\tlet index = withIndex;\n\t\tlet interval = withInterval;\n\t\tif (isNotDefined(index)) {\n\t\t\tconst response = doStuff(realDateAccessor, inputDateAccessor, initialIndex)(data);\n\t\t\tindex = response.index;\n\t\t\tinterval = response.interval;\n\t\t}\n\t\t// console.log(interval, entries[0].key);\n\n\t\tconst inputIndex = index.map(each => {\n\t\t\tconst { format } = each;\n\t\t\treturn {\n\t\t\t\t...each,\n\t\t\t\tdate: new Date(each.date),\n\t\t\t\tformat: timeFormat(format),\n\t\t\t};\n\t\t});\n\n\t\tconst xScale = financeDiscontinuousScale(inputIndex, interval);\n\n\t\tconst mergedData = zipper()\n\t\t\t.combine(indexMutator);\n\n\t\tconst finalData = mergedData(data, inputIndex);\n\n\t\treturn {\n\t\t\tdata: finalData,\n\t\t\txScale,\n\t\t\txAccessor: d => d && indexAccessor(d).index,\n\t\t\tdisplayXAccessor: realDateAccessor(inputDateAccessor),\n\t\t};\n\t};\n\n\tdiscontinuousTimeScaleProvider.initialIndex = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn initialIndex;\n\t\t}\n\t\tinitialIndex = x;\n\t\treturn discontinuousTimeScaleProvider;\n\t};\n\tdiscontinuousTimeScaleProvider.inputDateAccessor = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn inputDateAccessor;\n\t\t}\n\t\tinputDateAccessor = x;\n\t\treturn discontinuousTimeScaleProvider;\n\t};\n\tdiscontinuousTimeScaleProvider.indexAccessor = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn indexAccessor;\n\t\t}\n\t\tindexAccessor = x;\n\t\treturn discontinuousTimeScaleProvider;\n\t};\n\tdiscontinuousTimeScaleProvider.indexMutator = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn indexMutator;\n\t\t}\n\t\tindexMutator = x;\n\t\treturn discontinuousTimeScaleProvider;\n\t};\n\tdiscontinuousTimeScaleProvider.withIndex = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn withIndex;\n\t\t}\n\t\twithIndex = x;\n\t\treturn discontinuousTimeScaleProvider;\n\t};\n\tdiscontinuousTimeScaleProvider.withInterval = function(x) {\n\t\tif (!arguments.length) {\n\t\t\treturn withInterval;\n\t\t}\n\t\twithInterval = x;\n\t\treturn discontinuousTimeScaleProvider;\n\t};\n\tdiscontinuousTimeScaleProvider.utc = function() {\n\t\trealDateAccessor = dateAccessor => d => {\n\t\t\tconst date = dateAccessor(d);\n\t\t\t// The getTimezoneOffset() method returns the time-zone offset from UTC, in minutes, for the current locale.\n\t\t\tconst offsetInMillis = date.getTimezoneOffset() * 60 * 1000;\n\t\t\treturn new Date(date.getTime() + offsetInMillis);\n\t\t};\n\t\treturn discontinuousTimeScaleProvider;\n\t};\n\tdiscontinuousTimeScaleProvider.indexCalculator = function() {\n\t\treturn doStuff(realDateAccessor, inputDateAccessor, initialIndex);\n\t};\n\n\treturn discontinuousTimeScaleProvider;\n}\n\n\n\n/* discontinuousTimeScaleProvider.utc = function(data,\n\t\tdateAccessor,\n\t\tindexAccessor,\n\t\tindexMutator) {\n\tvar utcDateAccessor = d => {\n\t\tvar date = dateAccessor(d);\n\t\t// The getTimezoneOffset() method returns the time-zone offset from UTC, in minutes, for the current locale.\n\t\tvar offsetInMillis = date.getTimezoneOffset() * 60 * 1000;\n\t\treturn new Date(date.getTime() + offsetInMillis);\n\t};\n\treturn discontinuousTimeScaleProvider(data, utcDateAccessor, indexAccessor, indexMutator);\n};*/\n\nexport default discontinuousTimeScaleProviderBuilder();\n"]}