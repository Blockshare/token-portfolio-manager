{"version":3,"sources":["../../../../src/lib/scale/financeDiscontinuousScale.js"],"names":["set","map","bisector","ascending","scaleLinear","isNotDefined","head","last","tickLevels","target","level","MAX_LEVEL","tickLevelBisector","d","left","financeDiscontinuousScale","index","interval","backingLinearScale","Error","scale","x","invert","inverted","Math","round","domain","arguments","length","range","rangeRound","clamp","interpolate","ticks","m","flexTicks","backingTicks","ticksMap","domainStart","domainEnd","start","max","ceil","abs","end","min","floor","desiredTickCount","i","ticksAtLevel","get","temp","slice","j","push","unsortedTicks","concat","sort","ticksSet","distance","remove","tickValues","values","parseInt","ticksv1","newM","levelIndex","tickFormat","format","date","nice","copy"],"mappings":"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","file":"financeDiscontinuousScale.js","sourcesContent":["\"use strict\";\n\nimport { set, map } from \"d3-collection\";\nimport { bisector, ascending } from \"d3-array\";\nimport { scaleLinear } from \"d3-scale\";\n\nimport { isNotDefined, head, last } from \"../utils\";\n\nconst tickLevels = [\n\t{ target: 50e2, level: 0 },\n\t{ target: 50e3, level: 1 },\n\t{ target: 10e4, level: 2 },\n\t{ target: 28e4, level: 3 },\n\t{ target: 55e4, level: 4 },\n\t{ target: 11e5, level: 5 },\n\t{ target: 21e5, level: 6 },\n\t{ target: 43e5, level: 7 },\n\t{ target: 59e5, level: 8 }, // not tested\n\t{ target: 12e6, level: 9 }, // not tested\n\t{ target: 58e6, level: 10 }, // not tested\n\t{ target: 89e6, level: 11 },\n\t{ target: 11e7, level: 12 },\n\t{ target: 78e7, level: 13 },\n\t{ target: 16e8, level: 14 },\n\t{ target: 62e8, level: 15 },\n\t{ target: 10e20, level: 16 },\n];\n\nconst MAX_LEVEL = 17;\n\nconst tickLevelBisector = bisector(function(d) { return d.target; }).left;\n\nexport default function financeDiscontinuousScale(index,\n\tinterval,\n\tbackingLinearScale = scaleLinear()) {\n\n\tif (isNotDefined(index) /* || isNotDefined(interval) */)\n\t\tthrow new Error(\"Use the discontinuousTimeScaleProvider to create financeDiscontinuousScale\");\n\n\tfunction scale(x) {\n\t\treturn backingLinearScale(x);\n\t}\n\tscale.invert = function(x) {\n\t\tconst inverted = backingLinearScale.invert(x);\n\t\treturn Math.round(inverted * 10000) / 10000;\n\t};\n\tscale.domain = function(x) {\n\t\tif (!arguments.length) return backingLinearScale.domain();\n\t\tbackingLinearScale.domain(x);\n\t\treturn scale;\n\t};\n\tscale.range = function(x) {\n\t\tif (!arguments.length) return backingLinearScale.range();\n\t\tbackingLinearScale.range(x);\n\t\treturn scale;\n\t};\n\tscale.rangeRound = function(x) {\n\t\treturn backingLinearScale.range(x);\n\t};\n\tscale.clamp = function(x) {\n\t\tif (!arguments.length) return backingLinearScale.clamp();\n\t\tbackingLinearScale.clamp(x);\n\t\treturn scale;\n\t};\n\tscale.interpolate = function(x) {\n\t\tif (!arguments.length) return backingLinearScale.interpolate();\n\t\tbackingLinearScale.interpolate(x);\n\t\treturn scale;\n\t};\n\tscale.ticks = function(m, flexTicks) {\n\t\tconst backingTicks = backingLinearScale.ticks(m);\n\t\tconst ticksMap = map();\n\n\t\tconst [domainStart, domainEnd] = backingLinearScale.domain();\n\n\t\tconst start = Math.max(Math.ceil(domainStart), head(index).index) + Math.abs(head(index).index);\n\t\tconst end = Math.min(Math.floor(domainEnd), last(index).index) + Math.abs(head(index).index);\n\n\t\tconst desiredTickCount = Math.ceil((end - start) / (domainEnd - domainStart) * backingTicks.length);\n\n\t\tfor (let i = MAX_LEVEL; i >= 0; i--) {\n\t\t\tconst ticksAtLevel = ticksMap.get(i);\n\t\t\tconst temp = isNotDefined(ticksAtLevel)\n\t\t\t\t? []\n\t\t\t\t: ticksAtLevel.slice();\n\n\t\t\tfor (let j = start; j <= end; j++) {\n\t\t\t\tif (index[j].level === i) {\n\t\t\t\t\ttemp.push(index[j]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tticksMap.set(i, temp);\n\t\t}\n\n\t\tlet unsortedTicks = [];\n\t\tfor (let i = MAX_LEVEL; i >= 0; i--) {\n\t\t\tif ((ticksMap.get(i).length + unsortedTicks.length) > desiredTickCount * 1.5) break;\n\t\t\tunsortedTicks = unsortedTicks.concat(ticksMap.get(i).map(d => d.index));\n\t\t}\n\n\t\tconst ticks = unsortedTicks.sort(ascending);\n\n\t\t// console.log(backingTicks.length, desiredTickCount, ticks, ticksMap);\n\n\t\tif (!flexTicks && end - start > ticks.length) {\n\t\t\tconst ticksSet = set(ticks);\n\n\t\t\tconst d = Math.abs(head(index).index);\n\n\t\t\t// ignore ticks within this distance\n\t\t\tconst distance = Math.ceil(\n\t\t\t\t(backingTicks.length > 0\n\t\t\t\t\t? (last(backingTicks) - head(backingTicks)) / (backingTicks.length) / 4\n\t\t\t\t\t: 1) * 1.5);\n\n\t\t\tfor (let i = 0; i < ticks.length - 1; i++) {\n\t\t\t\tfor (let j = i + 1; j < ticks.length; j++) {\n\t\t\t\t\tif (ticks[j] - ticks[i] <= distance) {\n\t\t\t\t\t\tticksSet.remove(index[ticks[i] + d].level >= index[ticks[j] + d].level ? ticks[j] : ticks[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst tickValues = ticksSet.values().map(d => parseInt(d, 10));\n\n\t\t\t// console.log(ticks.length, tickValues, level);\n\t\t\t// console.log(ticks, tickValues, distance);\n\n\t\t\treturn tickValues;\n\t\t}\n\n\t\treturn ticks;\n\t};\n\tscale.ticksv1 = function(m) {\n\n\t\tconst [domainStart, domainEnd] = backingLinearScale.domain();\n\n\t\tconst start = Math.max(Math.ceil(domainStart), head(index).index) + Math.abs(head(index).index);\n\t\tconst end = Math.min(Math.floor(domainEnd), last(index).index) + Math.abs(head(index).index);\n\n\t\t// console.log(index.length, domainStart, domainEnd, start, end)\n\n\t\tconst newM = ((end - start) / (domainEnd - domainStart)) * m;\n\t\t// newM = newM <= 0 ? m : newM;\n\t\tconst target = Math.round((end - start + 1) * interval / newM);\n\n\t\t// var subList = index.slice(start, end + 1);\n\t\tconst levelIndex = tickLevelBisector(tickLevels, target);\n\t\tconst { level } = tickLevels[levelIndex];\n\t\t// console.log(target, level, levelIndex)\n\n\t\t// console.log(target.toExponential(), level);\n\n\t\tconst backingTicks = backingLinearScale.ticks(m);\n\n\t\t// console.log(backingTicks.length, ratio, distance, level)\n\n\t\tconst ticks = [];\n\t\tfor (let i = start; i < end + 1; i++) {\n\t\t\tif (index[i].level >= level) ticks.push(index[i].index);\n\t\t}\n\n\t\t// subList.filter(each => each.level >= level).map(d => d.index);\n\n\t\tconst ticksSet = set(ticks);\n\t\t// console.log(ticks);\n\n\t\tconst d = Math.abs(head(index).index);\n\n\t\t// ignore ticks within this distance\n\t\tconst distance = Math.ceil(\n\t\t\t(backingTicks.length > 0\n\t\t\t\t? (last(backingTicks) - head(backingTicks)) / (backingTicks.length) / 4\n\t\t\t\t: 1) * 1.5);\n\n\t\tfor (let i = 0; i < ticks.length - 1; i++) {\n\t\t\tfor (let j = i + 1; j < ticks.length; j++) {\n\t\t\t\tif (ticks[j] - ticks[i] < distance) {\n\t\t\t\t\tticksSet.remove(index[ticks[i] + d].level >= index[ticks[j] + d].level ? ticks[j] : ticks[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst tickValues = ticksSet.values().map(d => parseInt(d, 10));\n\t\t// console.log(ticks.length, tickValues, level, distance);\n\t\treturn tickValues;\n\t};\n\tscale.tickFormat = function() {\n\t\treturn function(x) {\n\t\t\t// console.log(x)\n\t\t\tconst d = Math.abs(head(index).index);\n\t\t\tconst { format, date } = index[x + d];\n\t\t\treturn format(date);\n\t\t};\n\t};\n\tscale.nice = function(m) {\n\t\tbackingLinearScale.nice(m);\n\t\treturn scale;\n\t};\n\tscale.copy = function() {\n\t\treturn financeDiscontinuousScale(index, interval, backingLinearScale.copy());\n\t};\n\treturn scale;\n}"]}